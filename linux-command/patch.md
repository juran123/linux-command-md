## patch ##

为开放源代码软件安装补丁程序

### 补充说明 ###

**patch命令** 被用于为开放源代码软件安装补丁程序。让用户利用设置修补文件的方式，修改，更新原始文件。如果一次仅修改一个文件，可直接在命令列中下达指令依序执行。如果配合修补文件的方式则能一次修补大批文件，这也是Linux系统核心的升级方法之一。


###  语法

	patch(选项)(参数)

###  选项

	-b或--backup：备份每一个原始文件；
	-B<备份字首字符串>或--prefix=<备份字首字符串>：设置文件备份时，附加在文件名称前面的字首字符串，
      该字符串可以是路径名称；
	-c或--context：把修补数据解译成关联性的差异；
	-d<工作目录>或--directory=<工作目录>：设置工作目录；
	-D<标示符号>或--ifdef=<标示符号>：用指定的符号把改变的地方标示出来；
	-e或--ed：把修补数据解译成ed指令可用的叙述文件；
	-E或--remove-empty-files：若修补过后输出的文件其内容是一片空白，则移除该文件；
	-f或--force：此参数的效果和指定"-t"参数类似，但会假设修补数据的版本为新版本；
	-F<监别列数>或--fuzz<监别列数>：设置监别列数的最大值；
	-g<控制数值>或--get=<控制数值>：设置以RSC或SCCS控制修补作业；
	-i<修补文件>或--input=<修补文件>：读取指定的修补问家你；
	-l或--ignore-whitespace：忽略修补数据与输入数据的跳格，空格字符；
	-n或--normal：把修补数据解译成一般性的差异；
	-N或--forward：忽略修补的数据较原始文件的版本更旧，或该版本的修补数据已使 用过；
	-o<输出文件>或--output=<输出文件>：设置输出文件的名称，修补过的文件会以该名称存放；
	-p<剥离层级>或--strip=<剥离层级>：设置欲剥离几层路径名称；
	-f<拒绝文件>或--reject-file=<拒绝文件>：设置保存拒绝修补相关信息的文件名称，预设的文件名称为.rej；
	-R或--reverse：假设修补数据是由新旧文件交换位置而产生；
	-s或--quiet或--silent：不显示指令执行过程，除非发生错误；
	-t或--batch：自动略过错误，不询问任何问题；
	-T或--set-time：此参数的效果和指定"-Z"参数类似，但以本地时间为主；
	-u或--unified：把修补数据解译成一致化的差异；
	-v或--version：显示版本信息；

###  参数 

* 原文件：指定需要打补丁的原始文件；
* 补丁文件：指定补丁文件。

###  实例

### 1.以统一格式显示两个C语言代码的比较结果。

	#	diff -u test.c tst/test.c
	--- test.c	2014-12-25 14:09:35.150670280 +0800
	+++ tst/test.c	2014-12-25 14:07:50.966670708 +0800
	@@ -28,9 +28,13 @@
	 	{
	 		return -1;
	 	}
	+	memset(line,0,uLen);
	 	
	 	if(fread(line,sizeof(char),uLen,sFile) != uLen)     //读取原文件内容，如果文件很大，请分块读取
	 	{
	+		printf("updatefile:fopen error");
	+		fclose(sFile);
	+		free(line);
	 		return -1;
	 	}
	
	补丁头：以---/+++开头的两行，用来表示要打补丁的文件；其中---开头的表示旧文件，+++开头的表示新文件。
	一个补丁文件中可能包含多个---/+++开头的节，每一个节用来打一个补丁。
	快：补丁中需要修改的地方。通常以@@开始，快得第一列+号表示这一行是需要增加的，-号表示这一行是需要删除的。

### 2.使用diff创建单个文件的补丁文件

	#	diff -uN test.c tst/test.c>test.patch
	test.patch文件记录了tst/test.c文件与原有test.c文件的差异。
### 3.为单个文件升级。
	为单个文件升级有两种方法，一是根据补丁文件升级，另一种是在命令行直接指明要修补的文件和文件补丁。在命令提示符下输入：
	#	patch -p0 test.c test.patch          //源文件与补丁文件在当前目录下
	#	patch -p0 <test.patch                 //patch读取补丁文件内容，自动搜索文件

